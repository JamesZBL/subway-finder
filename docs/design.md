这是北京地铁线路图。现在需要实现一个SPA前端应用。

# 名次解释：
* 开始起步：列车从某个站点开出
* 到站完成：列车到达某个站点完全停下
* 区间：从A站到B站之间的闭塞区间
* 行驶进度：从A站到B站距离a，已行驶距离为b，则行驶进度=a÷b，例如65.20%
* 选择线路：从运行图中给出的各线路中选择一条线路，比如选择了‘4号线’
* 运行数据：核心内容是一条线路在某班次在各站点到达和起步的真实时间，比如4号线某班次，在公益西桥到达时间是'2025-04-11 15:32:05'
* 采集运行数据：列车到站时点击站点名称到站，列车起步时点击站点名称起步，比如点击‘公益西桥-到站’、‘新宫-起步’
* 校准运行数据：运行数据首次采集之后允许再次采集，数据不会被覆盖，多条数据的作用有’计算两站点之间的平均运行时间‘等
* 撤销选择：选择到站或起步的操作如果是误操作，点击‘撤销到站’或‘撤销起步’，需要从存储中移除这条数据
* 开始展示：在列车到达某个站点或从某个站点起步时，点击按钮后开始展示，比如点击‘公益西桥-到站’，则页面开始展示列车当前运行位置，前提是运行数据已经采集
* 展示列车位置：展示列车当前在运行图中的位置
* 预计时间：根据采集到的数据，展示列车当前运行到某个站点的预计时间，比如‘公益西桥-预计到达时间18:23:25（3分钟后）’
* 数据推断：如果某条线路采集过运行数据，但是只录入过部分站点的数据，则根据部分数据，推断列车平均运行速度，用于展示列车位置
* 线路换乘：采集数据时支持切换线路，比如‘切换到7号线’，以满足换乘的场景
* 数据上报：将列车运行数据推送到服务器

# 功能点
## 首页
### 展示按钮
* 采集运行数据
* 开始展示

## 地图页
### 元素
* 展示运行图（地图），标记列车当前位置
* 展示进度条，标记列车所处的位置，比如a站、b站、c站，列车当前位于a和b站之间60%进度的位置
* 列车位置、进度条实时刷新
* 展示‘切换线路’按钮
* 地图支持手势缩放
* 展示 +/- 按钮用于缩放地图


## 预计时间页

## 运行数据采集页
### 展示按钮
* 选择路线

## 路线选择页
### 展示列表
* 1号线
* 4号线
* 6号线
* ...以此类推

## 站点选择页
### 展示列表
* 列表分两列，左侧为到达，右侧为起步
* 例如：第1行，左侧按钮'公益西桥-到达'，右侧按钮'公益西桥-起步'。第2行，左侧按钮'新宫-到达'，右侧按钮'新宫-起步'。

## 页面跳转逻辑
* 首页 -> 采集运行数据按钮 -> 路线选择页 -> 点击某个线路 -> 站点选择页
* 首页 -> 开始展示 -> 路线选择页 -> 点击某个线路 -> 站点选择页 -> 点击某站按钮 -> 地图页
* 地图页 -> 切换线路 -> 路线选择页 -> 点击某个线路 -> 站点选择页 -> 点击某站按钮 -> 地图页

# 技术要求
* 代码尽可能简洁，技术栈不要过于的重
* 页面尽可能同时适配PC、平板和手机端
* 页面风格尽可能美观，符合当前主流应用界面风格
* 数据支持存储在本地，比如LocalStorage中
* 数据不能被轻易的清理掉
* 数据上报等需要和服务器交互的功能，暂时不用实现具体如何与服务器交互，留出扩展接口即可
* 应用需要支持通过浏览器直接访问
* 应用部署不要太复杂
* 应用要考虑适配不同操作系统，比如iOS、Android、鸿蒙等

# 改进点1
* 地图目前支持放大，但是放大比例不够，需要支持放大到更大，比如1000%
* 目前各站点的坐标都是0，需要解析docs中的运行图，拿到各个站点在图片中的具体坐标，然后更新到代码中
* 选择线路页，选择某个线路后，需要增加选择运行方向的功能，比如选择4号线后，跳转到‘选择方向页’，展示两个方向，‘开往安河桥北’、‘开往天宫院’
* 同时，数据存储页需要对某个线路的两个方向单独存储
* 地图页需要支持根据当前选择的方向来展示列车位置及进度条

# 改进点2
* 选择站点后没有提示，需要弹出toast提示，提示内容如‘公益西桥，已到站’、‘公益西桥-已起步’等

# 改进点3
* 地图页进度条的展示，需要结合运行数据和当前状态计算并展示具体的运行进度
* 预计到达目前展示未知，需要结合运行数据和当前状态计算并展示具体的预计到达时间

# 改进点4
* 地图页，当前站点元素所在的行，展示占比过大，优化一下排布，尽可能占用的高度不要超过10%，展示在一行中
* 未知、数据推断中，此类展示需要确认具体原因，比如‘未知-缺少数据’、‘数据推断中-未采集数据’等

# 改进5
* 地图页，进度条不要被地图遮挡

# 改进6
* 地图页，进度条不要遮挡在地图上。

# 改进7
* 选择站点页，选择选择的运行方向和站点，判断之后的操作是否合法，比如运行站点顺序为a->b->c，选择b站起步后，下一个操作不能为a到站
* 选择站点页，选择站点后，显示当前状态，，比如运行站点顺序为a->b->c，选择b站起步后，展示‘当前位置：b开往c’、选择c站到达后，展示‘当前位置：c站已到达’
* 站点选择可以跳站，比如运行站点顺序为a->b->c，选择b到站之后，选择c到站，是合法的，计算平均运行时间等算法时需要涵盖这种场景

# 改进8
* 选择站点页，进入页面后，默认是初始状态，不要加载上次的状态

# 改进9
* 选择站点页，选择站点后，展示‘已停车x秒’、‘x站起步后已行驶y秒’
* 选择站点页，选择a站起步后，需要屏蔽按钮‘a站到达’，因为不符合正常逻辑

# 改进10
* 选择站点页，选择a站起步后，需要屏蔽按钮‘a站起步’，因为不能起步两次 

# 改进11
* 选择站点页，初始状态下，始发站不能到达，终到站不能到达，因为没有意义

# 改进12
* 选择站点页，初始状态下，始发站可以起步，终到站不能起步，因为没有意义

# 改进13
* 在合适的位置增加按钮‘返回首页’按钮，以便在任何页面能快速返回首页

# 改进14
* 地图页展示当前位置，需要根据采集的数据计算运行时间，比如a站到b站，历史数据显示平均需要运行90秒，则点击完a站起步后，进度条90秒走完，走完之后才能变更状态到b站已到达，以此类推。目前a站起步后，立刻变成了b站到达，检查代码问题并修改。

# 改进15
* 目前计算行驶比例的逻辑依然不对。
* 计算行驶比例的正确逻辑：假设历史数据有3条，第1条是a站于0分到达，第2条为a站于0分30秒起步，第3条为于2分01秒到达b站。那么可以得知a站停车时间为z1=30秒，a站到b站运行时长为z2=1分01秒。地图页，选择了a站到达后，记录一个时间戳x，那么1秒钟后的时间戳为y，此时的形式比例为 (y-x)÷z，约等于3%。

# 改进16
* 修改calculateRealProgress方法，添加参数1‘开始时间’，添加参数2‘类型’（1停车/2起步）。逻辑：假设入参类型为2（起步），入参开始时间为d，方法开始执行，获取当前时间为n，读取历史数据计算从a站到b站平均运行时长是y秒，那么计算的返回行驶比例percent=(n-d)/y

# 改进17
* 目前只有4号线可以选择方向，需要修改数据，对其他线路也展示分别两个方向

# 改进18
* 修改数据，对全部线路生成两个方向

# 改进19
* 修改修改calculateRealProgress方法，增加日志打印，打印所有参数以及每个计算步骤

# 改进20
* 修改计算行驶进度的地方，状态发生变化（具体表现在进度>100%），证明停车结束了、或者行驶结束了，需要将开始时间参数刷新成当前时间，以保证下个计算周期的开始时间是正确的

# 改进21
* 地图页，增加一个展示状态‘a站停车中’、‘a站开往b站’，以区分不同的状态
* 预计到达，需要实时计算，根据开始时间、历史平均运行时间计算。如果状态是停车，需要计算预发车时间；如果状态是运行中，需要计算预计到达时间。

# 改进22
* 页面需要撑满屏幕
* 地图默认撑满容器
* 地图放大后需要支持拖动移动位置

# 改进23
* 地图页，地图放大后不能变模糊，需要保持原始分辨率

# 改进24
* 计算停车进度需要根据历史数据，计算从a站停车到a站起步的平均耗时，再计算出当前的停车进度比例

# 改进25
* 地图页，到达终点站后，状态变成已到达终点站，此时列车位置以及进度条不要再运行

# 改进26
* 地图页，预计发车、到达时间，以及对应的‘n秒后’，需要根据历史数据实时刷新

# 改进27
* 地图页，刷新频率改为100毫秒

# 改进28
* 地图页，所有时间均按 HH:mm:dd 格式展示，目前发现秒有缺失

# 改进29
* 地图页，运行到没有数据的站点之后，按照默认时间来运行；目前发现遇到没有数据的站点后直接重新回到了始发站，需要修复这个问题

# 改进30
* 地图页，进度条上不要显示列车图标

# 改进31
* 地图页，按+按钮放大后图片模糊，请修改，保证放大后图片按原图画质展示

# 改进32
* 读取线路图，计算各个站点在图中的坐标(x,y)

# 改进33
* 地图页，列车位置图标展示错误，需要根据坐标数据，展示在相对于图片的坐标位置

# 改进34
* 将这个应用修改成只适配手机端，不再适配电脑和平板，修改界面风格为与最新iOS系统相同，竖版页面；必要时可引入依赖或库

# 改进35
http://www.mtr.bj.cn/service/line/timetable/line-4，这是地铁运行时刻表，里面有4条线路。解析页面中的时刻表，并生成时刻表代码作为基础数据。修改判断行驶进度的算法，将运行平均时长改为从时刻表数据中获取。

# 改进36
目前停车时长为0，需要根据列车时刻表推算停车时长，不能到站后立刻起步